import{W as i,r as l,a1 as d}from"./index-DH6y1Cde.js";async function u(){return await i("/api/tasks")}async function f(s){return(await i("/api/tasks/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).task}async function w(s,t){return(await i(`/api/tasks/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).task}async function k(s){await i(`/api/tasks/start/${s}`,{method:"POST"})}async function S(s){await i(`/api/tasks/stop/${s}`,{method:"POST"})}async function g(s){await i(`/api/tasks/${s}`,{method:"DELETE"})}class h{ws=null;reconnectInterval=3e3;listeners=new Map;isConnected=!1;constructor(){this.connect()}connect(){const t=window.location.protocol==="https:"?"wss:":"ws:",e=window.location.host,n=`${t}//${e}/ws`;console.log(`Connecting to WebSocket at ${n}`),this.ws=new WebSocket(n),this.ws.onopen=()=>{console.log("WebSocket connected"),this.isConnected=!0,this.emit("connected",{isConnected:!0})},this.ws.onmessage=o=>{try{const a=JSON.parse(o.data);a.type&&this.emit(a.type,a.data)}catch(a){console.error("Failed to parse WebSocket message",a)}},this.ws.onclose=()=>{this.isConnected&&(console.log("WebSocket disconnected"),this.isConnected=!1,this.emit("disconnected",{isConnected:!1})),setTimeout(()=>this.connect(),this.reconnectInterval)},this.ws.onerror=o=>{console.error("WebSocket error:",o),this.ws?.close()}}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t)?.push(e)}off(t,e){const n=this.listeners.get(t);if(n){const o=n.indexOf(e);o!==-1&&n.splice(o,1)}}emit(t,e){const n=this.listeners.get(t);n&&n.forEach(o=>o(e))}}const c=new h,r=l(c.isConnected);c.on("connected",()=>{r.value=!0});c.on("disconnected",()=>{r.value=!1});function m(){function s(t,e){c.on(t,e),d(()=>{c.off(t,e)})}return{isConnected:r,on:s}}export{k as a,w as b,f as c,g as d,u as g,S as s,m as u};
