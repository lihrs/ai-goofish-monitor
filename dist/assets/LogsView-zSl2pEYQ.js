import{W as k,r as i,p as b,a2 as A,d as R,Y as E,c as T,b as m,a as l,w as s,f as n,e as t,h as y,_ as $,t as I,J as N,K as U,L as B,M as D,N as M,O,H as C,o as H,a3 as S}from"./index-DH6y1Cde.js";import{_ as h}from"./Switch.vue_vue_type_script_setup_true_lang-D_cuhvZe.js";import{_ as z,a as j}from"./CardContent.vue_vue_type_script_setup_true_lang-AENY5R10.js";import"./VisuallyHiddenInput-BWXw6jel.js";async function G(o=0){return await k("/api/logs",{params:{from_pos:o}})}async function J(){await k("/api/logs",{method:"DELETE"})}function K(){const o=i(""),r=i(0),c=i(!0),d=i(!1),p=i(null);let u=null;const v=2e5,_="...日志过长已截断，仅保留最新内容...";function f(a){if(a&&(o.value+=a,o.value.length>v)){const V=o.value.slice(-15e4);o.value=`${_}
${V}`}}async function g(){if(!d.value){d.value=!0;try{const a=await G(r.value);a.new_pos<r.value&&(o.value=""),a.new_content&&f(a.new_content),r.value=a.new_pos}catch(a){a instanceof Error&&(p.value=a)}finally{d.value=!1}}}async function L(){try{await J(),o.value="",r.value=0}catch(a){throw a instanceof Error&&(p.value=a),a}}function w(){u||(g(),u=window.setInterval(g,2e3),c.value=!0)}function x(){u&&(clearInterval(u),u=null),c.value=!1}function e(){c.value?x():w()}return b(()=>{w()}),A(()=>{x()}),{logs:o,isAutoRefresh:c,isLoading:d,error:p,fetchLogs:g,clearLogs:L,toggleAutoRefresh:e}}const P={class:"h-[calc(100vh-100px)] flex flex-col"},W={class:"flex justify-between items-center mb-4"},X={class:"flex items-center gap-4"},Y={class:"flex items-center space-x-2"},q={class:"flex items-center space-x-2"},te=R({__name:"LogsView",setup(o){const{logs:r,isAutoRefresh:c,clearLogs:d,toggleAutoRefresh:p,fetchLogs:u}=K(),v=i(null),_=i(!0),f=i(!1);E(r,async()=>{_.value&&(await S(),g())});function g(){v.value&&(v.value.scrollTop=v.value.scrollHeight)}function L(){f.value=!0}async function w(){try{await d(),C({title:"日志已清空"})}catch(x){C({title:"清空日志失败",description:x.message,variant:"destructive"})}finally{f.value=!1}}return(x,e)=>(H(),T("div",P,[m("div",W,[e[7]||(e[7]=m("h1",{class:"text-2xl font-bold text-gray-800"},"运行日志",-1)),m("div",X,[l(t(y),{variant:"outline",size:"sm",onClick:t(u)},{default:s(()=>[...e[3]||(e[3]=[n(" 刷新 ",-1)])]),_:1},8,["onClick"]),m("div",Y,[l(t(h),{id:"auto-refresh","model-value":t(c),"onUpdate:modelValue":t(p)},null,8,["model-value","onUpdate:modelValue"]),l(t($),{for:"auto-refresh"},{default:s(()=>[...e[4]||(e[4]=[n("自动刷新",-1)])]),_:1})]),m("div",q,[l(t(h),{id:"auto-scroll",modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a)},null,8,["modelValue"]),l(t($),{for:"auto-scroll"},{default:s(()=>[...e[5]||(e[5]=[n("自动滚动",-1)])]),_:1})]),l(t(y),{variant:"destructive",size:"sm",onClick:L},{default:s(()=>[...e[6]||(e[6]=[n(" 清空日志 ",-1)])]),_:1})])]),l(t(j),{class:"flex-1 overflow-hidden flex flex-col"},{default:s(()=>[l(t(z),{class:"flex-1 p-0 relative"},{default:s(()=>[m("pre",{ref_key:"logContainer",ref:v,class:"absolute inset-0 p-4 bg-gray-950 text-gray-100 font-mono text-sm overflow-auto whitespace-pre-wrap break-all"},I(t(r)),513)]),_:1})]),_:1}),l(t(O),{open:f.value,"onUpdate:open":e[2]||(e[2]=a=>f.value=a)},{default:s(()=>[l(t(N),{class:"sm:max-w-[420px]"},{default:s(()=>[l(t(U),null,{default:s(()=>[l(t(B),null,{default:s(()=>[...e[8]||(e[8]=[n("清空运行日志",-1)])]),_:1}),l(t(D),null,{default:s(()=>[...e[9]||(e[9]=[n(" 此操作不可恢复，确定要清空所有日志吗？ ",-1)])]),_:1})]),_:1}),l(t(M),null,{default:s(()=>[l(t(y),{variant:"outline",onClick:e[1]||(e[1]=a=>f.value=!1)},{default:s(()=>[...e[10]||(e[10]=[n("取消",-1)])]),_:1}),l(t(y),{variant:"destructive",onClick:w},{default:s(()=>[...e[11]||(e[11]=[n("确认清空",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}});export{te as default};
